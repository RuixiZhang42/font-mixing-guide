%
% This is file `mtpro2-patch.tex'.
%
% The standard usage is:
%
%   \usepackage[<options>]{mtpro2}
%   \newcommand*\mtpscale{0.908}
%   \newcommand*\mtpscriptscale{0.845}
%   \newcommand*\mtpscriptscriptscale{0.792}
%   \input{mtpro2-patch}
%   % Note:
%   %   If not specified, then \mtpscale will be set to 1.
%   %   If not specified, then each of \mtpscriptscale and
%   % \mtpscriptscriptscale will be set to \mtpscale.
%
% There are 14 bugs needed to be fixed by hand.
%
% Warning: The \arc, \Arc and \widearc math accents are
%          incomplete in the Complete font set!!!
%            Use the Lite font set (e.g., from CTAN) to
%          get full glyph coverage.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the following line
%
%   \alloc@0\count\countdef\insc@unt\pointcount@
%
% with
%
%   \newcount\pointcount@
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', remove all the occurrences of
%
%   \let\{=\lbrace % 3 times
%
% and
%
%   \let\}=\rbrace % 3 times
%
% in \curlybraces, \straightbraces and \morphedbraces
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', remove the pair
%
%   \@ifpackageloaded{amsmath}{}{%
%   }
%
% containing
%
%   \let\doteq\@undefined ...
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the following 2 occurrences of
%
%   \char12
%
% in \EXtest@ (twice) with
%
%   \char28
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the definition of \specdelim@ with
%
%   \def\specdelim@#1{\ifx#1(\specdelim@true
%    \else\ifx#1)\specdelim@true
%    \else\ifx#1<\specdelim@true
%    \else\ifx#1\langle\specdelim@true
%    \else\ifx#1>\specdelim@true
%    \else\ifx#1\rangle\specdelim@true
%    \else\ifx#1/\specdelim@true
%    \else\ifx#1\backslash\specdelim@true
%    \else\ifx#1\{\specdelim@true
%    \else\ifx#1\}\specdelim@true
%    \else\ifx#1\lbrace\specdelim@true
%    \else\ifx#1\rbrace\specdelim@true
%    \else\ifx#1\lcbrace\specdelim@true
%    \else\ifx#1\rcbrace\specdelim@true
%    \else\specdelim@false\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the following line
%
%   \left#1
%
% in \LEFTRIGHT with
%
%   \left#1%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the following line
%
%   \kern-2\nulldelimiterspace\mskip-\thinmuskip
%
% in \LEFTRIGHT with
%
%   \kern-2\nulldelimiterspace
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the following 2 occurrences of
%
%   \MTEXA@ d
%
% in \@widetilde (once) and \widetildedown (once) with
%
%   \MTEXA@ g
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the following 2 occurrences of
%
%   \MTEXA@ z
%
% in \@widecheck (once) and \widecheckdown (once) with
%
%   \MTEXA@|
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the following occurrence of
%
%   \mathaccent"03D0
%
% in \widearc with
%
%   \mathaccent"03CF
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the following line
%
%   \mkern-1mu\kern-.13\dimen@\mkern\LEFTROOT@ mu\box\z@\kern-\wd\rootbox
%
% in \R@@T with
%
%   \mkern-1mu\kern-.13\dimen@\mkern\LEFTROOT@ mu\box\z@
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', replace the following 2 lines
%
%   \ifx\next\uprod\xlposition@10\else
%   \ifx\next\ucoprod\xlposition@11\else
%
% in \XXXL@ with
%
%   \ifx\next\upprod\xlposition@10\else
%   \ifx\next\upcoprod\xlposition@11\else
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', insert the following 9 lines
%
%   \DeclareMathSymbol{\nleq}         {\mathrel}{AMSa}{"82}
%   \DeclareMathSymbol{\ngeq}         {\mathrel}{AMSa}{"83}
%   \DeclareMathSymbol{\nless}        {\mathrel}{AMSa}{"84}
%   \DeclareMathSymbol{\ngtr}         {\mathrel}{AMSa}{"85}
%   \DeclareMathSymbol{\nprec}        {\mathrel}{AMSa}{"86}
%   \DeclareMathSymbol{\nsucc}        {\mathrel}{AMSa}{"87}
%   \DeclareMathSymbol{\ncong}        {\mathrel}{AMSa}{"9D}
%   \DeclareMathSymbol{\nsqsubseteq}    {\mathrel}{AMSa}{217}
%   \DeclareMathSymbol{\nsqsupseteq}    {\mathrel}{AMSa}{218}
%
% in order according to `mtpro2.dtx'
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% In `mtpro2.sty', remove the pair
%
%   \@ifpackageloaded{textcomp}{}{%
%   }
%
% containing
%
%   \DeclareTextSymbolDefault{\textdagger}{LMP1} ...
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\makeatletter
% Scale factors
\ifx\mtpscale\@undefined
  \def\mtpscale{1}
\fi
\ifx\mtpscriptscale\@undefined
  \let\mtpscriptscale\mtpscale
\fi
\ifx\mtpscriptscriptscale\@undefined
  \let\mtpscriptscriptscale\mtpscale
\fi
% MathTime Professional 2 Lite
\DeclareFontShape{LMP1}{mtt}{m}{it}{%
  <-7> s*[\mtpscriptscriptscale] mt2mif
  <7-9> s*[\mtpscriptscale] mt2mis
  <9-> s*[\mtpscale] mt2mit}{}
\DeclareFontShape{LMP2}{mtt}{m}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2syf
  <7-9> s*[\mtpscriptscale] mt2sys
  <9-> s*[\mtpscale] mt2syt}{\skewchar\font32}
\DeclareFontShape{LMP3}{mtt}{m}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2exa
  <7-9> s*[\mtpscriptscale] mt2exa
  <9-> s*[\mtpscale] mt2exa}{}
\DeclareFontShape{U}{mtt}{b}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2mbf
  <7-9> s*[\mtpscriptscale] mt2mbs
  <9-> s*[\mtpscale] mt2mbt}{}
\normalsize
\dimen@\f@size\p@
\dimen@\mtpscale\dimen@
\newdimen\tMTPscalesize
\tMTPscalesize\dimen@
\font\MTEXA@=mt2exa at \the\dimen@
\font\MTXL@=mt2xl at \the\dimen@
\multiply\dimen@\tw@
\font\MTEXE@=mt2exe at \the\dimen@
\font\MTXXXL@=mt2xxxl at \the\dimen@
\multiply\dimen@\tw@
\font\MTEXF@=mt2exf at \the\dimen@
\multiply\dimen@\tw@
\font\MTEXG@=mt2exg at \the\dimen@
% MathTime Professional 2 Complete
\ifmtp@full
\DeclareFontShape{LMP1}{mtt}{b}{it}{%
  <-7> s*[\mtpscriptscriptscale] mt2bmif
  <7-9> s*[\mtpscriptscale] mt2bmis
  <9-> s*[\mtpscale] mt2bmit}{}
\DeclareFontShape{LMP2}{mtt}{b}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2bsyf
  <7-9> s*[\mtpscriptscale] mt2bsys
  <9-> s*[\mtpscale] mt2bsyt}{\skewchar\font32}
\DeclareFontShape{LMP2}{mtt}{eb}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2hsyf
  <7-9> s*[\mtpscriptscale] mt2hsys
  <9-> s*[\mtpscale] mt2hsyt}{\skewchar\font32}
\DeclareFontShape{LMP3}{mtt}{b}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2bexa
  <7-9> s*[\mtpscriptscale] mt2bexa
  <9-> s*[\mtpscale] mt2bexa}{}
\DeclareFontShape{LMP3}{mtt}{eb}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2hexa
  <7-9> s*[\mtpscriptscale] mt2hexa
  <9-> s*[\mtpscale] mt2hexa}{}
\DeclareFontShape{U}{mt2sya}{m}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2syaf
  <7-9> s*[\mtpscriptscale] mt2syas
  <9-> s*[\mtpscale] mt2syat}{}
\DeclareFontShape{U}{mt2sya}{b}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2bsyaf
  <7-9> s*[\mtpscriptscale] mt2bsyas
  <9-> s*[\mtpscale] mt2bsyat}{}
\DeclareFontShape{U}{mt2sya}{eb}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2hsyaf
  <7-9> s*[\mtpscriptscale] mt2hsyas
  <9-> s*[\mtpscale] mt2hsyat}{}
% umt2ms.fd
\DeclareFontFamily{U}{mt2ms}{\skewchar\font42}
\DeclareFontShape{U}{mt2ms}{m}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2mcf
  <7-9> s*[\mtpscriptscale] mt2mcs
  <9-> s*[\mtpscale] mt2mct}{}
\DeclareFontShape{U}{mt2ms}{m}{it}{%
  <-7> s*[\mtpscriptscriptscale] mt2msf
  <7-9> s*[\mtpscriptscale] mt2mss
  <9-> s*[\mtpscale] mt2mst}{}
\DeclareFontShape{U}{mt2ms}{b}{it}{%
  <-7> s*[\mtpscriptscriptscale] mt2bmsf
  <7-9> s*[\mtpscriptscale] mt2bmss
  <9-> s*[\mtpscale] mt2bmst}{}
% umt2mf.fd
\DeclareFontFamily{U}{mt2mf}{}
\DeclareFontShape{U}{mt2mf}{m}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2mff
  <7-9> s*[\mtpscriptscale] mt2mfs
  <9-> s*[\mtpscale] mt2mft}{}
\DeclareFontShape{U}{mt2mf}{b}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2bmff
  <7-9> s*[\mtpscriptscale] mt2bmfs
  <9-> s*[\mtpscale] mt2bmft}{}
% umt2bb.fd
\DeclareFontFamily{U}{mt2bb}{\skewchar\font45}
\DeclareFontShape{U}{mt2bb}{m}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2bbf
  <7-9> s*[\mtpscriptscale] mt2bbs
  <9-> s*[\mtpscale] mt2bbt}{}
\DeclareFontShape{U}{mt2bb}{m}{it}{%
  <-7> s*[\mtpscriptscriptscale] mt2bbif
  <7-9> s*[\mtpscriptscale] mt2bbis
  <9-> s*[\mtpscale] mt2bbit}{}
\DeclareFontShape{U}{mt2bb}{b}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2bbdf
  <7-9> s*[\mtpscriptscale] mt2bbds
  <9-> s*[\mtpscale] mt2bbdt}{}
% umt2hrb.fd
\DeclareFontFamily{U}{mt2hrb}{\skewchar\font45}
\DeclareFontShape{U}{mt2hrb}{m}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2hrbf
  <7-9> s*[\mtpscriptscale] mt2hrbs
  <9-> s*[\mtpscale] mt2hrbt}{}
\DeclareFontShape{U}{mt2hrb}{m}{it}{%
  <-7> s*[\mtpscriptscriptscale] mt2hbif
  <7-9> s*[\mtpscriptscale] mt2hbis
  <9-> s*[\mtpscale] mt2hbit}{}
\DeclareFontShape{U}{mt2hrb}{b}{n}{%
  <-7> s*[\mtpscriptscriptscale] mt2hrbdf
  <7-9> s*[\mtpscriptscale] mt2hrbds
  <9-> s*[\mtpscale] mt2hrbdt}{}
\fi
% \bBiggg support
% Example definitions:
%   \mtp@bBigg@\MTEXE@\thr@@, \mtp@bBigg@\MTEXE@{3.5}, ..., \mtp@bBigg@\MTEXE@{5.5};
%   \mtp@bBigg@\MTEXF@6,      \mtp@bBigg@\MTEXF@7,     ..., \mtp@bBigg@\MTEXF@{11};
%   \mtp@bBigg@\MTEXG@{12},   \mtp@bBigg@\MTEXG@{14},  ..., \mtp@bBigg@\MTEXG@{24}.
\newcommand*\mtp@bBigg@[3]{%
  \leavevmode@ifvmode
  {\hbox{%
    \specdelim@#3%
    \ifspecdelim@
      \textfont\thr@@=#1%
      \ifnum
        \ifx#3\{1\else\ifx#3\}1\else
        \ifx#3\lbrace 1\else\ifx#3\rbrace 1\else 0\fi\fi\fi\fi
          =1 %
        \ifx\lbrace\lcbrace\else
          \textfont\thr@@=\MTEXA@
        \fi
      \fi
    \fi
    $\left#3\vcenter to#2\big@size{}\right.\n@space$%
  }}%
}
% Fix \undercbrace and \overcbrace
\def\undercbrace#1{\setbox\z@\hbox{$\displaystyle#1$}%
 \dimen@\wd\z@
 \pointcount@\numexpr(\dimen@-\tMTPscalesize/2)/\tMTPscalesize\relax
 \ifnum\pointcount@<4
  \ifdim\wd\z@<1.35\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char144}}%
  \else\ifdim\wd\z@<1.65\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char145}}%
  \else\ifdim\wd\z@<1.95\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char146}}%
  \else\ifdim\wd\z@<2.25\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char147}}%
  \else\ifdim\wd\z@<2.55\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char148}}%
  \else\ifdim\wd\z@<2.85\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char149}}%
  \else\ifdim\wd\z@<3.15\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char150}}%
  \else\ifdim\wd\z@<3.45\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char151}}%
  \else
   \def\thebrace@{\hbox{\MTEXE@\char152}}%
  \fi\fi\fi\fi\fi\fi\fi\fi
 \else
  \ifnum\pointcount@<12
    \advance\pointcount@149
    \def\thebrace@{\hbox{\MTEXE@\char\pointcount@}}%
  \else
   \ifnum\pointcount@<24
    \advance\pointcount@132
    \def\thebrace@{\hbox{\MTEXF@\char\pointcount@}}%
   \else
    \advance\pointcount@120
    \ifnum\pointcount@>149 \pointcount@149 \fi
    \def\thebrace@{\hbox{\MTEXG@\char\pointcount@}}%
   \fi
  \fi
 \fi
 \mathop{\vtop{\ialign{\hfil##\hfil\cr$\displaystyle#1$\crcr\noalign
  {\vskip3pt\nointerlineskip}\thebrace@\cr\noalign{\kern3pt}}}}\limits}%
\def\overcbrace#1{\setbox\z@\hbox{$\displaystyle#1$}%
 \dimen@\wd\z@
 \pointcount@\numexpr(\dimen@-\tMTPscalesize/2)/\tMTPscalesize\relax
 \ifnum\pointcount@<4
  \ifdim\wd\z@<1.35\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char176}}%
  \else\ifdim\wd\z@<1.65\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char177}}%
  \else\ifdim\wd\z@<1.95\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char178}}%
  \else\ifdim\wd\z@<2.25\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char179}}%
  \else\ifdim\wd\z@<2.55\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char180}}%
  \else\ifdim\wd\z@<2.85\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char181}}%
  \else\ifdim\wd\z@<3.15\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char182}}%
  \else\ifdim\wd\z@<3.45\tMTPscalesize
   \def\thebrace@{\hbox{\MTEXE@\char183}}%
  \else
   \def\thebrace@{\hbox{\MTEXE@\char184}}%
  \fi\fi\fi\fi\fi\fi\fi\fi
 \else
  \ifnum\pointcount@<12
    \advance\pointcount@181
    \def\thebrace@{\hbox{\MTEXE@\char\pointcount@}}%
  \else
   \ifnum\pointcount@<24
    \advance\pointcount@148
    \def\thebrace@{\hbox{\MTEXF@\char\pointcount@}}%
   \else
    \advance\pointcount@136
    \ifnum\pointcount@>165 \pointcount@165 \fi
    \def\thebrace@{\hbox{\MTEXG@\char\pointcount@}}%
   \fi
  \fi
 \fi
 \mathop{\vbox{\ialign{\hfil##\hfil\cr\noalign{\kern3\p@}\thebrace@\crcr
 \noalign{\kern3\p@\nointerlineskip}$\displaystyle#1$\crcr}}}\limits}%
% Add \textbardbl and \textbigcircle; Redeclare \textcircled
\DeclareTextSymbolDefault{\textbardbl}{LMP2}
\DeclareTextSymbol{\textbardbl}{LMP2}{107}
\DeclareTextSymbol{\textbigcircle}{LMP2}{13}
\DeclareTextCommand{\textcircled}{LMP2}[1]{\hmode@bgroup
   \ooalign{%
      \hfil \raise .07ex\hbox {\upshape#1}\hfil \crcr
      \char 13 % "0D
   }%
 \egroup}
\AtBeginDocument{%
  % Fix \big@size calculation
  \addto@hook\every@math@size{%
    \global\big@size\dimexpr\fontdimen6\textfont\thr@@*6/5\relax}%
  % Fix \mathsterling and \mathunderscore for OpenType text fonts
  \@ifpackageloaded{fontspec}{%
    \DeclareMathSymbol{\mathsterling}{\mathord}{operators}{"A3}%
    \let\mathunderscore\@undefined
    \DeclareMathSymbol{\mathunderscore}{\mathord}{operators}{95}%
    % These should be fixed by fontspec, I think...
    \DeclareSymbolFont{operators}{\encodingdefault}{\rmdefault}{\mddefault}{\updefault}%
    \SetSymbolFont{operators}{bold}{\encodingdefault}{\rmdefault}{\bfdefault}{\updefault}%
    \DeclareMathAlphabet{\mathbf}{\encodingdefault}{\rmdefault}{\bfdefault}{\updefault}%
    \DeclareMathAlphabet{\mathit}{\encodingdefault}{\rmdefault}{\mddefault}{\itdefault}%
    \DeclareMathAlphabet{\mathsf}{\encodingdefault}{\sfdefault}{\mddefault}{\updefault}%
    \DeclareMathAlphabet{\mathtt}{\encodingdefault}{\ttdefault}{\mddefault}{\updefault}%
    \SetMathAlphabet{\mathit}{bold}{\encodingdefault}{\rmdefault}{\bfdefault}{\itdefault}%
    \SetMathAlphabet{\mathsf}{bold}{\encodingdefault}{\sfdefault}{\bfdefault}{\updefault}%
    \SetMathAlphabet{\mathtt}{bold}{\encodingdefault}{\ttdefault}{\bfdefault}{\updefault}%
  }{}%
  % Troubles with U+00B7 (\char'267, \char183) being CJK punctuation
  \@ifpackageloaded{xeCJK}{%
    \def\widearc#1{\setbox\ARCbox@\hbox{$\displaystyle{#1}$}%
      \setbox\z@\hbox{\makexeCJKinactive\MTEXF@\char'267}%
       \ifdim\wd\ARCbox@>\wd\z@
        \hbox{\textfont3=\MTEXG@ $\mathaccent"03B1 {\box\ARCbox@}$}%
       \else
        \setbox\z@\hbox{\MTEXE@\char'326}%
        \ifdim\wd\ARCbox@>\wd\z@
         \hbox{\textfont3=\MTEXF@ $\mathaccent"03B1 {\box\ARCbox@}$}%
        \else
         \setbox\z@\hbox{\MTEXA@ \char'302}%
         \ifdim\wd\ARCbox@>\wd\z@
          \hbox{\textfont3=\MTEXE@ $\mathaccent"03CF {\box\ARCbox@}$}%
         \else
          \hbox{\textfont3=\MTEXA@ $\mathaccent"03BF {\box\ARCbox@}$}%
         \fi
        \fi
       \fi}%
    \def\overcbrace#1{\setbox\z@\hbox{$\displaystyle#1$}%
     \dimen@\wd\z@
     \pointcount@\numexpr(\dimen@-\tMTPscalesize/2)/\tMTPscalesize\relax
     \ifnum\pointcount@<4
      \ifdim\wd\z@<1.35\tMTPscalesize
       \def\thebrace@{\hbox{\MTEXE@\char176}}%
      \else\ifdim\wd\z@<1.65\tMTPscalesize
       \def\thebrace@{\hbox{\MTEXE@\char177}}%
      \else\ifdim\wd\z@<1.95\tMTPscalesize
       \def\thebrace@{\hbox{\MTEXE@\char178}}%
      \else\ifdim\wd\z@<2.25\tMTPscalesize
       \def\thebrace@{\hbox{\MTEXE@\char179}}%
      \else\ifdim\wd\z@<2.55\tMTPscalesize
       \def\thebrace@{\hbox{\MTEXE@\char180}}%
      \else\ifdim\wd\z@<2.85\tMTPscalesize
       \def\thebrace@{\hbox{\MTEXE@\char181}}%
      \else\ifdim\wd\z@<3.15\tMTPscalesize
       \def\thebrace@{\hbox{\MTEXE@\char182}}%
      \else\ifdim\wd\z@<3.45\tMTPscalesize
       \def\thebrace@{\hbox{\makexeCJKinactive\MTEXE@\char183}}%
      \else
       \def\thebrace@{\hbox{\MTEXE@\char184}}%
      \fi\fi\fi\fi\fi\fi\fi\fi
     \else
      \ifnum\pointcount@<12
        \advance\pointcount@181
        \def\thebrace@{\hbox{\MTEXE@\char\pointcount@}}%
      \else
       \ifnum\pointcount@<24
        \advance\pointcount@148
        \def\thebrace@{\hbox{\MTEXF@\char\pointcount@}}%
       \else
        \advance\pointcount@136
        \ifnum\pointcount@>165 \pointcount@165 \fi
        \def\thebrace@{\hbox{\MTEXG@\char\pointcount@}}%
       \fi
      \fi
     \fi
     \mathop{\vbox{\ialign{\hfil##\hfil\cr\noalign{\kern3\p@}\thebrace@\crcr
     \noalign{\kern3\p@\nointerlineskip}$\displaystyle#1$\crcr}}}\limits}%
  }{}%
}
% CTeX setup
%   Assuming \mtpscale             = 1.10502958579881657
%            \mtpscriptscale       = 1.03309552688947532
%            \mtpscriptscriptscale = 1.01898220001940052
% \defaultscriptratio       = 0.7
% \defaultscriptscriptratio = 0.55
\DeclareMathSizes{7.5bp}{7.5bp}{5.343pt}{5pt}
\DeclareMathSizes{9bp}{9bp}{6.858pt}{5.388pt}
\DeclareMathSizes{10.5bp}{10.5bp}{7.891pt}{6.286pt}
\DeclareMathSizes{12bp}{12bp}{8.999pt}{6.999pt}% Sub-optimal
\makeatother